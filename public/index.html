<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <form>
    <p>
      <label for="text">text</label>
      <input type="text" name="text" id="text">
    </p>
    <p>
      <button id="saveText">Submit</button>
    </p>
  </form>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    let db
    const request = indexedDB.open('textDB', 1)

    const saveText = text => {
      const transaction = db.transaction(['text'], 'readwrite')
      const store = transaction.objectStore('text')
      store.add({ text })
    }

    // scales out database if not built already
    request.onupgradeneeded = event => {
      const db = event.target.result
      const objectStore = db.createObjectStore('text', { autoIncrement: true })
      objectStore.createIndex('text', 'text')
    }

    // when the request is successful
    request.onsuccess = event => {
      db = event.target.result
      const transaction = db.transaction(['text'], 'readwrite')
      const store = transaction.objectStore('text')
      const textIndex = store.index('text')

      // retrieve based on index
      // const getOnIndex = textIndex.getAll('John Doe')

      // getOnIndex.onsuccess = () => {
      //   console.log(getOnIndex.result)
      // }

      // get on id
      // const first = store.get(1)

      // first.onsuccess = () => {
      //   console.log(first.result)
      // }

      // how to get all items
      const getAll = store.getAll()

      // listener for get all success
      getAll.onsuccess = () => {
        console.log(getAll.result)
      }

      // how to add items to a store
      // store.add({ text: 'hotdog' })
      // store.add({ text: 'jellyfish' })
      // store.add({ text: 'John Doe' })
      // store.add({ text: 'John Doe' })

    }

    // when the request errors out
    request.onerror = event => {
      console.log('db error')
    }

    document.getElementById('saveText').addEventListener('click', event => {
      event.preventDefault()
      saveText(document.getElementById('text').value)
      document.getElementById('text').value = ''
    })
  </script>
</body>
</html>